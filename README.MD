Hier ist eine ausfÃ¼hrliche README.md fÃ¼r dein Git-Repository, die dokumentiert, was der ACCpromAdapter macht, welche Technologien verwendet wurden und wie das Projekt strukturiert ist. Die README enthÃ¤lt auch Anweisungen zur Einrichtung und Nutzung.

ACCpromAdapter

Version: 1.0
Autor: Christian Strube
Lizenz: MIT

ğŸ“ Beschreibung

ACCpromAdapter ist eine macOS-MenÃ¼leisten-App, die den Apple Content Cache Ã¼berwacht und die Metriken im Prometheus-Format bereitstellt. Die App liest die Metrics.db aus dem Systemverzeichnis aus und stellt sie Ã¼ber einen integrierten HTTP-Server zur VerfÃ¼gung. So kÃ¶nnen die Daten direkt in Grafana oder andere Monitoring-Tools integriert werden.

ğŸ¯ Features

âœ… Prometheus-kompatible Metriken
âœ… Leichtgewichtiger HTTP-Server auf Port 9200
âœ… Security-Scoped Bookmarks fÃ¼r Zugriff auf geschÃ¼tzte Dateien
âœ… MenÃ¼leisten-App ohne Dock-Icon
âœ… Einfache Konfiguration und automatische Speicherung der Dateiauswahl
âœ… Automatische Aktualisierung der Metriken Ã¼ber Combine
âœ… Option zur RÃ¼cksetzung der Einstellungen

ğŸ—ï¸ Architektur

Das Projekt ist in Swift geschrieben und verwendet SwiftUI fÃ¼r die MenÃ¼leiste sowie SwiftNIO fÃ¼r den HTTP-Server.

ğŸ”¹ Komponenten:
    1.    AppDelegate.swift
    â€¢    Initialisiert die App und prÃ¼ft, ob der Port 9200 verfÃ¼gbar ist.
    â€¢    Verwaltet den Zugriff auf die Metrics.db mithilfe von Security-Scoped Bookmarks.
    â€¢    Falls keine Datei gespeichert ist, Ã¶ffnet es einen Dateiauswahldialog.
    2.    PrometheusServer.swift
    â€¢    Startet einen HTTP-Server mit SwiftNIO auf Port 9200.
    â€¢    Liefert Metriken aus dem MetricsCache zurÃ¼ck.
    â€¢    Verhindert, dass der Server blockiert, indem Metriken im Hintergrund aktualisiert werden.
    3.    AssetCacheAnalyzer.swift
    â€¢    Liest die Metrics.db mit SQLite aus.
    â€¢    Parst die Z-Werte aus der Datenbank und konvertiert sie in ein Prometheus-kompatibles Format.
    â€¢    Zerlegt Werte mit Einheiten (z.â€¯B. MB, GB) in numerische Werte.
    4.    MetricsFetcher.swift
    â€¢    Observables mit Combine, um UI-Updates nur auszufÃ¼hren, wenn Metriken aktualisiert wurden.
    â€¢    KÃ¼mmert sich um das Abrufen und Verarbeiten der Daten fÃ¼r die UI.
    5.    ContentView.swift
    â€¢    Die MenÃ¼leisten-OberflÃ¤che zur Anzeige der wichtigsten Metriken.
    â€¢    EnthÃ¤lt Buttons fÃ¼r Safari, Kopieren der URL und Neustarten der Metriken.
    â€¢    Reset-Funktion fÃ¼r UserDefaults (zum Testen nÃ¼tzlich).

ğŸš€ Installation
    1.    Projekt klonen

git clone https://github.com/dein-github/ACCpromAdapter.git
cd ACCpromAdapter


    2.    Xcode Ã¶ffnen

open ACCpromAdapter.xcodeproj


    3.    Signatur einrichten (falls nÃ¶tig)
    â€¢    In den Xcode Signing & Capabilities die Entwickler-ID eintragen.
    4.    App starten
    â€¢    DrÃ¼cke Cmd + R, um die App zu starten.

ğŸ”§ Troubleshooting

âŒ Kein Zugriff auf die Metrics.db
    â€¢    Stelle sicher, dass die App in den Systemeinstellungen â†’ Datenschutz & Sicherheit â†’ Festplattenvollzugriff eingetragen ist.

âŒ Port 9200 ist blockiert
    â€¢    PrÃ¼fe mit:

lsof -i :9200

Falls ein anderer Prozess den Port belegt:

kill -9 <PID>



âŒ Keine Metriken in Grafana
    â€¢    PrÃ¼fe, ob die Prometheus-URL korrekt ist:

http://localhost:9200/metrics

ğŸ“Œ Geplante Features

âœ… XPC-Service fÃ¼r Sandbox-Modus
âœ… Detailliertere Metriken mit Einheiten (MB, GB, KB)
ğŸ”œ Automatische Installation als LaunchDaemon
ğŸ”œ Benachrichtigungen bei kritischen Cache-Werten

âš–ï¸ Lizenz

Dieses Projekt steht unter der MIT-Lizenz â€“ du kannst es frei verwenden, modifizieren und verteilen.
